<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MindAxis - Aurora Edition (Fixed)</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts (Rounded Mplus) -->
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@300;400;500;700&display=swap"
        rel="stylesheet">

    <!-- React & ReactDOM -->
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin
        src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>

    <!-- Babel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"M PLUS Rounded 1c"', 'sans-serif'],
                    },
                    colors: {
                        primary: '#9F7AEA',   // Soft Purple
                        secondary: '#F687B3', // Soft Pink
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'breathe': 'breathe 4s ease-in-out infinite',
                        'fade-in': 'fadeIn 0.6s ease-out forwards',
                        'slide-up': 'slideUp 0.5s ease-out forwards',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        },
                        breathe: {
                            '0%, 100%': { transform: 'scale(1)', opacity: '0.8' },
                            '50%': { transform: 'scale(1.05)', opacity: '1' },
                        },
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #F7FAFC;
            margin: 0;
        }

        .glass {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-top: 1px solid rgba(255, 255, 255, 0.8);
        }

        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>

<body>
    <div id="root" class="h-screen w-screen flex items-center justify-center text-slate-400">Loading...</div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- Icons ---
        const Icon = ({ name, size = 24, color = "currentColor" }) => {
            const paths = {
                Home: <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />,
                Feather: <path d="M20.24 12.24a6 6 0 0 0-8.49-8.49L5 10.5V19h8.5z M16 8L2 22 M17.5 15H9" />,
                HeartHand: <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" />,
                Send: <><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></>,
                Refresh: <><path d="M23 4v6h-6 M1 20v-6h6"></path><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></>,
                Share: <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8 M16 6l-4-4-4 4 M12 2v13" />,
            };
            return (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                    {paths[name] || <circle cx="12" cy="12" r="10" />}
                </svg>
            );
        };

        // --- Data & Logic ---

        // 50 Questions: MBTI (4 axes), Thinking (Visual/Verbal), Memory (Aphantasia/Hyper)
        // Dimensions: 
        // EI: Extrovert/Introvert
        // SN: Sensing/Intuition
        // TF: Thinking/Feeling
        // JP: Judging/Perceiving
        // V: Visual (Hyperphantasia) vs Abstract (Aphantasia)
        // M: Mindset (Future/Past)

        const QUESTIONS = [
            // Phase 1: Energy & Focus (EI)
            { id: 1, text: "é€±æœ«ã¯ä¸€äººã§é™ã‹ã«éã”ã™ã‚ˆã‚Šã‚‚ã€è³‘ã‚„ã‹ãªå ´æ‰€ã§äººã¨ä¼šã„ãŸã„ã€‚", type: "EI", weight: 1 },
            { id: 2, text: "è€ƒãˆã‚’ã¾ã¨ã‚ã‚‹å‰ã«ã€ã¾ãšè©±ã—å§‹ã‚ã¦ã—ã¾ã†ã“ã¨ãŒå¤šã„ã€‚", type: "EI", weight: 1 },
            { id: 3, text: "æ³¨ç›®ã‚’æµ´ã³ã‚‹ã“ã¨ã¯ã€ãã‚Œã»ã©è‹¦ã§ã¯ãªã„ã€‚", type: "EI", weight: 1 },
            { id: 4, text: "æ–°ã—ã„ç’°å¢ƒã§ã¯ã€è‡ªåˆ†ã‹ã‚‰ç©æ¥µçš„ã«è©±ã—ã‹ã‘ã‚‹æ–¹ã ã€‚", type: "EI", weight: 1 },
            { id: 5, text: "å‹äººã¨é•·æ™‚é–“éã”ã™ã¨ã€ç–²ã‚Œã‚ˆã‚Šã‚‚æ´»åŠ›ã‚’æ„Ÿã˜ã‚‹ã€‚", type: "EI", weight: 1 },

            // Phase 2: Information & Perception (SN)
            { id: 6, text: "ç‰©äº‹ã‚’èª¬æ˜ã™ã‚‹æ™‚ã€å…·ä½“çš„ãªäº‹å®Ÿã‚ˆã‚Šã‚‚å…¨ä½“åƒã‚„æ„å‘³ã‹ã‚‰è©±ã™ã€‚", type: "SN", weight: 1 }, // +SN = N
            { id: 7, text: "ã€Œä½•ãŒèµ·ãã¦ã„ã‚‹ã‹ã€ã‚ˆã‚Šã‚‚ã€Œãªãœèµ·ãã¦ã„ã‚‹ã‹ã€ã«èˆˆå‘³ãŒã‚ã‚‹ã€‚", type: "SN", weight: 1 },
            { id: 8, text: "ç¾å®Ÿçš„ãªãƒ‡ãƒ¼ã‚¿ã‚ˆã‚Šã‚‚ã€å°†æ¥ã®å¯èƒ½æ€§ã‚„ç©ºæƒ³ã«æƒ¹ã‹ã‚Œã‚‹ã€‚", type: "SN", weight: 1 },
            { id: 9, text: "è©³ç´°ãªæ‰‹é †æ›¸ã‚ˆã‚Šã‚‚ã€å¤§ã¾ã‹ãªã‚³ãƒ³ã‚»ãƒ—ãƒˆã ã‘ç¤ºã•ã‚Œã‚‹æ–¹ãŒå‹•ãã‚„ã™ã„ã€‚", type: "SN", weight: 1 },
            { id: 10, text: "æ£®ã‚’è¦‹ãŸæ™‚ã€æœ¨ã®ç¨®é¡ã‚ˆã‚Šã‚‚æ£®å…¨ä½“ã®é›°å›²æ°—ã‚„ç‰©èªã‚’æ„Ÿã˜ã‚‹ã€‚", type: "SN", weight: 1 },

            // Phase 3: Decision Making (TF)
            { id: 11, text: "æ±ºæ–­ã‚’ä¸‹ã™æ™‚ã€è«–ç†çš„ãªæ­£ã—ã•ã‚ˆã‚Šã‚‚ã€å‘¨å›²ã¨ã®èª¿å’Œã‚’å„ªå…ˆã™ã‚‹ã€‚", type: "TF", weight: 1 }, // +TF = F
            { id: 12, text: "å‹äººãŒæ‚©ã‚“ã§ã„ã‚‹æ™‚ã€è§£æ±ºç­–ã‚’å‡ºã™ã‚ˆã‚Šå…ˆã«å…±æ„Ÿã—ã¦è©±ã‚’èãã€‚", type: "TF", weight: 1 },
            { id: 13, text: "è­°è«–ã«ãŠã„ã¦ã€çœŸå®Ÿã‚’è¿½æ±‚ã™ã‚‹ã“ã¨ã‚ˆã‚Šã€èª°ã‚‚å‚·ã¤ã‘ãªã„ã“ã¨ãŒé‡è¦ã ã€‚", type: "TF", weight: 1 },
            { id: 14, text: "æ‰¹åˆ¤ã•ã‚Œã‚‹ã¨ã€å†…å®¹ã®å¦¥å½“æ€§ã‚’è€ƒãˆã‚‹å‰ã«æ„Ÿæƒ…çš„ã«å‚·ã¤ã„ã¦ã—ã¾ã†ã€‚", type: "TF", weight: 1 },
            { id: 15, text: "å…¬å¹³ã•ã¨ã¯ã€å…¨å“¡ã«åŒã˜ãƒ«ãƒ¼ãƒ«ã‚’é©ç”¨ã™ã‚‹ã“ã¨ã§ã¯ãªãã€å€‹ã€…ã®äº‹æƒ…ã‚’æ±²ã‚€ã“ã¨ã ã¨æ€ã†ã€‚", type: "TF", weight: 1 },

            // Phase 4: Lifestyle (JP)
            { id: 16, text: "æ—…è¡Œã®è¨ˆç”»ã¯ãã£ã¡ã‚Šç«‹ã¦ã‚‹ã‚ˆã‚Šã‚‚ã€è¡Œãå½“ãŸã‚Šã°ã£ãŸã‚Šã‚’æ¥½ã—ã¿ãŸã„ã€‚", type: "JP", weight: 1 }, // +JP = P
            { id: 17, text: "æœºã®ä¸Šã‚„éƒ¨å±‹ã¯ã€æ•´ç†æ•´é “ã•ã‚Œã¦ã„ã‚‹ã‚ˆã‚Šæ•£ã‚‰ã‹ã£ã¦ã„ã‚‹ã“ã¨ãŒå¤šã„ã€‚", type: "JP", weight: 1 },
            { id: 18, text: "ç· ã‚åˆ‡ã‚Šã¯ä½™è£•ã‚’æŒã£ã¦çµ‚ã‚ã‚‰ã›ã‚‹ã‚ˆã‚Šã€ã‚®ãƒªã‚®ãƒªã¾ã§ç²˜ã£ã¦ä»•ä¸Šã’ã‚‹ã€‚", type: "JP", weight: 1 },
            { id: 19, text: "ä¼‘æ—¥ã®äºˆå®šã¯äº‹å‰ã«æ±ºã‚ã‚‹ã‚ˆã‚Šã€ãã®æ™‚ã®æ°—åˆ†ã§æ±ºã‚ãŸã„ã€‚", type: "JP", weight: 1 },
            { id: 20, text: "ãƒ«ãƒ¼ãƒ«ã‚„ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã¯çµ¶å¯¾çš„ãªã‚‚ã®ã§ã¯ãªãã€å˜ãªã‚‹ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã ã¨æ€ã†ã€‚", type: "JP", weight: 1 },

            // Phase 5: Visual Texture (Aphantasia - Hyperphantasia)
            { id: 21, text: "ã€Œèµ¤ã„ãƒªãƒ³ã‚´ã€ã‚’æƒ³åƒã—ãŸæ™‚ã€å†™çœŸã®ã‚ˆã†ã«é®®æ˜ãªæ˜ åƒãŒè¦‹ãˆã‚‹ã€‚", type: "V", weight: 1 },
            { id: 22, text: "éå»ã®æ€ã„å‡ºã¯ã€æ˜ ç”»ã®ã‚·ãƒ¼ãƒ³ã®ã‚ˆã†ã«ã‚ã‚Šã‚ã‚Šã¨å†ç”Ÿã§ãã‚‹ã€‚", type: "V", weight: 1 },
            { id: 23, text: "å°èª¬ã‚’èª­ã‚“ã§ã„ã‚‹ã¨ã€æƒ…æ™¯ãŒç›®ã®å‰ã«ãƒªã‚¢ãƒ«ã«åºƒãŒã‚‹ã€‚", type: "V", weight: 1 },
            { id: 24, text: "è¦ªã—ã„äººã®é¡”ã‚’æ€ã„æµ®ã‹ã¹ã‚‹æ™‚ã€ç´°éƒ¨ã¾ã§é®®æ˜ã«è¦‹ãˆã‚‹ã€‚", type: "V", weight: 1 },
            { id: 25, text: "ç©ºæƒ³ã®ä¸–ç•Œã«æ²¡å…¥ã—ã™ãã¦ã€ç¾å®Ÿã¨ã®å¢ƒç•ŒãŒæ›–æ˜§ã«ãªã‚‹ã“ã¨ãŒã‚ã‚‹ã€‚", type: "V", weight: 1 },

            // Phase 6: Thinking Style (Verbal vs Conceptual)
            { id: 26, text: "è€ƒãˆäº‹ã‚’ã™ã‚‹æ™‚ã€é ­ã®ä¸­ã§è¨€è‘‰ï¼ˆç‹¬ã‚Šè¨€ï¼‰ã‚’ä½¿ã‚ãšã«ã€ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚„æ„Ÿè¦šã§é€²ã‚ã‚‹ã“ã¨ãŒå¤šã„ã€‚", type: "M", weight: 1 }, // +M = Conceptual
            { id: 27, text: "è¤‡é›‘ãªæ¦‚å¿µã‚’ç†è§£ã™ã‚‹æ™‚ã€è«–ç†çš„ãªèª¬æ˜ã‚ˆã‚Šå›³è§£ã‚„ä¾‹ãˆè©±ã®æ–¹ãŒåˆ†ã‹ã‚Šã‚„ã™ã„ã€‚", type: "M", weight: 1 },
            { id: 28, text: "ã‚¢ã‚¤ãƒ‡ã‚¢ãŒæµ®ã‹ã¶æ™‚ã¯ã€è¨€è‘‰ã§ã¯ãªãå…¨ä½“åƒãŒãƒ‘ãƒƒã¨é–ƒãæ„Ÿã˜ã ã€‚", type: "M", weight: 1 },
            { id: 29, text: "æ–‡ç« ã‚’èª­ã‚€æ™‚ã€é ­ã®ä¸­ã§éŸ³èª­ã™ã‚‹ã‚ˆã‚Šã‚‚ã€æ–‡å­—ã®å½¢ã‚„æ„å‘³ã‚’ç›´æ¥æ‰ãˆã‚‹ã€‚", type: "M", weight: 1 },
            { id: 30, text: "ã€Œç„¡ã€ã‚’æƒ³åƒã™ã‚‹æ™‚ã€ã€Œç„¡ã€ã¨ã„ã†è¨€è‘‰ã§ã¯ãªãã€æš—é—‡ã‚„é™å¯‚ã®æ„Ÿè¦šãŒæµ®ã‹ã¶ã€‚", type: "M", weight: 1 },

            // Phase 7: Deep Dive (Abstract/Essence)
            { id: 31, text: "ä¸–ç•Œã¯ã€Œæ§‹é€ ã¨æ³•å‰‡ã€ã§ã¯ãªãã€ã€Œæ„Ÿæƒ…ã¨ç‰©èªã€ã§ã§ãã¦ã„ã‚‹ã¨æ„Ÿã˜ã‚‹ã€‚", type: "TF", weight: 1 }, // +TF
            { id: 32, text: "å­¤ç‹¬ã¯å¯‚ã—ã„ã‚‚ã®ã§ã¯ãªãã€è‡ªç”±ã§å¿«é©ãªã‚‚ã®ã ã¨æ„Ÿã˜ã‚‹ã€‚", type: "EI", weight: -1 }, // -EI (Introvert)
            { id: 33, text: "æ™‚é–“ã¯ç›´ç·šçš„ã«æµã‚Œã‚‹ã‚‚ã®ã§ã¯ãªãã€ä¼¸ç¸®ã—ãŸã‚Šå¾ªç’°ã—ãŸã‚Šã™ã‚‹ã‚‚ã®ã ã¨æ„Ÿã˜ã‚‹ã€‚", type: "JP", weight: 1 }, // +JP
            { id: 34, text: "æ­£ç¾©ã¨ã¯ã€æºã‚‹ããªã„åŸå‰‡ã§ã¯ãªãã€çŠ¶æ³ã«å¿œã˜ãŸæ…ˆæ‚²ã ã¨æ€ã†ã€‚", type: "TF", weight: 1 }, // +TF
            { id: 35, text: "å¤‰åŒ–ã¯è„…å¨ã§ã¯ãªãã€æ¥½ã—ã‚€ã¹ãæ©Ÿä¼šã ã¨æ„Ÿã˜ã‚‹ã€‚", type: "JP", weight: 1 }, // +JP
            { id: 36, text: "è‡ªåˆ†ã®è¨˜æ†¶ã¯äº‹å®Ÿãã®ã‚‚ã®ã¨ã„ã†ã‚ˆã‚Šã€ç¾åŒ–ã•ã‚ŒãŸç‰©èªã‹ã‚‚ã—ã‚Œãªã„ã¨æ€ã†ã€‚", type: "SN", weight: 1 }, // +SN
            { id: 37, text: "æ„Ÿæƒ…ã¯é ­ã§ç†è§£ã™ã‚‹ã‚‚ã®ã§ã¯ãªãã€èƒ¸ã‚„ãŠè…¹ãªã©ã®èº«ä½“æ„Ÿè¦šã¨ã—ã¦æ„Ÿã˜ã‚‹ã€‚", type: "TF", weight: 1 }, // +TF
            { id: 38, text: "å¤¢ï¼ˆç¡çœ æ™‚ï¼‰ã®å†…å®¹ã‚’ã€è‰²å½©ã‚„æ„Ÿè¦šã¾ã§é®®æ˜ã«è¦šãˆã¦ã„ã‚‹ã“ã¨ãŒå¤šã„ã€‚", type: "V", weight: 1 }, // +V
            { id: 39, text: "éŸ³æ¥½ã‚’è´ãã¨ã€æ­Œè©ã®æ„å‘³ã‚ˆã‚Šå…ˆã«è‰²ã‚„é¢¨æ™¯ãŒæµ®ã‹ã¶ã€‚", type: "M", weight: 1 }, // +M
            { id: 40, text: "ã€Œæ„›ã€ã¨ã„ã†è¨€è‘‰ã‹ã‚‰é€£æƒ³ã™ã‚‹ã®ã¯ã€å…·ä½“çš„ãªè¡Œå‹•ã‚ˆã‚Šã€è‰²ã‚„æ¸©åº¦ãªã©ã®æŠ½è±¡çš„ãªã‚¤ãƒ¡ãƒ¼ã‚¸ã ã€‚", type: "M", weight: 1 }, // +M

            // Phase 8: Final Essence
            { id: 41, text: "äººç”Ÿã¯ã€Œæˆ¦ã„ã€ã§ã¯ãªãã€Œæ—…ã€ã§ã‚ã‚‹ã€‚", type: "TF", weight: 1 },
            { id: 42, text: "æ¬²ã—ã„ã®ã¯ã€Œç¢ºå®Ÿãªå®‰å®šã€ã‚ˆã‚Šã€Œç„¡é™ã®å¯èƒ½æ€§ã€ã ã€‚", type: "SN", weight: 1 },
            { id: 43, text: "è‡ªåˆ†è‡ªèº«ã‚’ã€Œç†è§£ã—ã¦ã„ã‚‹ã€ã¨ã„ã†ã‚ˆã‚Šã€Œæ¢æ±‚ä¸­ã€ã ã¨æ„Ÿã˜ã‚‹ã€‚", type: "EI", weight: 1 }, // +EI (Openness?) -> Let's map to Intuition/Perceiving broadly, but keep EI for now as "External search"
            { id: 44, text: "è¨€è‘‰ã¯å˜ãªã‚‹ã€Œé“å…·ã€ã§ã¯ãªãã€ä¸–ç•Œã‚’å¤‰ãˆã‚‹ã€Œé­”æ³•ã€ã ã¨æ€ã†ã€‚", type: "M", weight: 1 },
            { id: 45, text: "å¤œç©ºã‚’è¦‹ä¸Šã’ãŸæ™‚ã€æ˜Ÿã®é…ç½®ã‚ˆã‚Šå®‡å®™ã®åºƒå¤§ã•ã«åœ§å€’ã•ã‚Œã‚‹ã€‚", type: "SN", weight: 1 },
            { id: 46, text: "ç´„æŸã¯çµ¶å¯¾å®ˆã‚‹ã¹ãã‚‚ã®ã¨ã„ã†ã‚ˆã‚Šã€ãã®æ™‚ã®æœ€å–„ã‚’å°½ãã™ãŸã‚ã®ç›®æ¨™ã ã€‚", type: "JP", weight: 1 },
            { id: 47, text: "ä»–è€…ã¯è‡ªåˆ†ã¨ã¯ç•°ãªã‚‹å€‹ä½“ã¨ã„ã†ã‚ˆã‚Šã€æ·±ã„ã¨ã“ã‚ã§ç¹‹ãŒã£ã¦ã„ã‚‹å­˜åœ¨ã ã¨æ„Ÿã˜ã‚‹ã€‚", type: "TF", weight: 1 },
            { id: 48, text: "éå»ã¯å¤‰ãˆã‚‰ã‚Œãªã„äº‹å®Ÿã§ã¯ãªãã€ä»Šã®è§£é‡ˆæ¬¡ç¬¬ã§å¤‰ã‚ã‚‹ç‰©èªã ã€‚", type: "SN", weight: 1 },
            { id: 49, text: "æœªæ¥ã¯äºˆæ¸¬ã™ã‚‹ã‚‚ã®ã¨ã„ã†ã‚ˆã‚Šã€è‡ªã‚‰ã®æ‰‹ã§å‰µé€ ã™ã‚‹ã‚‚ã®ã ã€‚", type: "JP", weight: 1 },
            { id: 50, text: "ä»Šã“ã®ç¬é–“ã¯ã€å˜ãªã‚‹é€šéç‚¹ã§ã¯ãªãã€æ°¸é ã®ä¸€éƒ¨ã ã¨æ„Ÿã˜ã‚‹ã€‚", type: "M", weight: 1 }
        ];

        const RESULT_ARCHETYPES = {
            // Introverted types
            "ISTJ": { name: "The Archivist", jp: "é™å¯‚ã®è¨˜éŒ²è€…", color: "from-slate-200 to-blue-200", desc: "äº‹å®Ÿã¨çµŒé¨“ã‚’é‡ã‚“ã˜ã‚‹ã€å …å®Ÿã§èª å®Ÿãªå®ˆè­·è€…ã€‚" },
            "ISFJ": { name: "The Protector", jp: "æ…ˆæ„›ã®å®ˆã‚Šäºº", color: "from-blue-100 to-pink-200", desc: "çŒ®èº«çš„ã§æ¸©ã‹ã„å¿ƒã‚’æŒã¡ã€å¤§åˆ‡ãªäººã‚’å®ˆã‚ŠæŠœãã€‚" },
            "INFJ": { name: "The Oracle", jp: "æ·±æ·µã®è³¢è€…", color: "from-purple-200 to-indigo-300", desc: "ç†æƒ³ã¨æ´å¯ŸåŠ›ã‚’æŒã¡ã€äººã€…ã®å°ãæ‰‹ã¨ãªã‚‹ã€‚" },
            "INTJ": { name: "The Architect", jp: "å­¤é«˜ã®è¨­è¨ˆè€…", color: "from-indigo-200 to-slate-300", desc: "ç‹¬å‰µçš„ãªãƒ“ã‚¸ãƒ§ãƒ³ã¨è«–ç†ã§ã€ä¸–ç•Œã‚’å†æ§‹ç¯‰ã™ã‚‹ã€‚" },
            "ISTP": { name: "The Artisan", jp: "å­¤é«˜ã®åŒ ", color: "from-slate-200 to-teal-200", desc: "å†·é™ãªè¦³å¯Ÿçœ¼ã¨å™¨ç”¨ã•ã§ã€å•é¡Œã‚’è§£æ±ºã™ã‚‹ã€‚" },
            "ISFP": { name: "The Artist", jp: "æ„Ÿæ€§ã®æ—…äºº", color: "from-green-100 to-yellow-200", desc: "è±Šã‹ãªæ„Ÿæ€§ã¨å„ªã—ã•ã§ã€ä¸–ç•Œã«å½©ã‚Šã‚’ä¸ãˆã‚‹ã€‚" },
            "INFP": { name: "The Healer", jp: "å¤¢è¦‹ã‚‹ç™’ã—æ‰‹", color: "from-pink-200 to-purple-200", desc: "ç´”ç²‹ãªç†æƒ³ã¨å…±æ„ŸåŠ›ã§ã€äººã€…ã®å¿ƒã‚’ç™’ã‚„ã™ã€‚" },
            "INTP": { name: "The Logician", jp: "çœŸç†ã®æ¢ç©¶è€…", color: "from-blue-200 to-cyan-200", desc: "é£½ããªãçŸ¥çš„å¥½å¥‡å¿ƒã§ã€ä¸–ç•Œã®ç†ã‚’è§£ãæ˜ã‹ã™ã€‚" },
            // Extroverted types
            "ESTP": { name: "The Dynamo", jp: "ç–¾é¢¨ã®å†’é™ºè€…", color: "from-orange-200 to-red-200", desc: "ã‚¨ãƒãƒ«ã‚®ãƒ¼ã«æº¢ã‚Œã€ä»Šã“ã®ç¬é–“ã‚’å…¨åŠ›ã§ç”Ÿãã‚‹ã€‚" },
            "ESFP": { name: "The Performer", jp: "å¤ªé™½ã®æ¼”è€…", color: "from-yellow-200 to-orange-200", desc: "å‘¨å›²ã‚’æ˜ã‚‹ãç…§ã‚‰ã—ã€äººç”Ÿã‚’ç¥­ã‚Šã¨ã—ã¦æ¥½ã—ã‚€ã€‚" },
            "ENFP": { name: "The Champion", jp: "è‡ªç”±ãªé©å‘½å®¶", color: "from-green-200 to-blue-200", desc: "æƒ…ç†±ã¨æƒ³åƒåŠ›ã§ã€äººã€…ã«å¯èƒ½æ€§ã‚’è¦‹ã›ã‚‹ã€‚" },
            "ENTP": { name: "The Debater", jp: "çŸ¥çš„ãªæŒ‘æˆ¦è€…", color: "from-red-200 to-purple-200", desc: "é‹­ã„é ­è„³ã¨å¼èˆŒã§ã€å¸¸è­˜ã‚’è¦†ã—ã¦ã„ãã€‚" },
            "ESTJ": { name: "The Director", jp: "ä¸å±ˆã®æŒ‡æ®å®˜", color: "from-blue-200 to-indigo-200", desc: "ç§©åºã¨ä¼çµ±ã‚’é‡ã‚“ã˜ã€çµ„ç¹”ã‚’åŠ›å¼·ãå°ãã€‚" },
            "ESFJ": { name: "The Caregiver", jp: "èª¿å’Œã®æä¾›è€…", color: "from-pink-200 to-red-100", desc: "ç´°ã‚„ã‹ãªæ°—é…ã‚Šã§ã€äººã€…ã®çµ†ã‚’æ·±ã‚ã‚‹ã€‚" },
            "ENFJ": { name: "The Protagonist", jp: "å¸Œæœ›ã®å…ˆå°è€…", color: "from-orange-100 to-purple-200", desc: "ã‚«ãƒªã‚¹ãƒæ€§ã¨å…±æ„ŸåŠ›ã§ã€äººã€…ã‚’ç†æƒ³ã¸å°ãã€‚" },
            "ENTJ": { name: "The Commander", jp: "è¦‡é“ã®çµ±ç‡è€…", color: "from-red-200 to-slate-300", desc: "é‰„ã®æ„å¿—ã¨æˆ¦ç•¥ã§ã€ä¸å¯èƒ½ã‚’å¯èƒ½ã«ã™ã‚‹ã€‚" }
        };

        // --- Components ---

        const TwinSimulation = ({ myType, otherType, onComplete }) => {
            const [logs, setLogs] = useState([]);
            const [progress, setProgress] = useState(0);

            useEffect(() => {
                const conversation = [
                    { t: 0, speaker: "me", text: "æ¥ç¶šã‚’é–‹å§‹ã—ã¾ã™..." },
                    { t: 1000, speaker: "other", text: "å¿œç­”ã‚’ç¢ºèªã€‚åŒæœŸãƒ¬ãƒ™ãƒ«è¨ˆæ¸¬ä¸­..." },
                    { t: 2500, speaker: "me", text: `ç§ã¯${myType.jp}ã€‚ç§ã®ç‰¹æ€§ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ã—ã¾ã™ã€‚` },
                    { t: 4000, speaker: "other", text: `å—ä¿¡ã—ã¾ã—ãŸã€‚ç§ã¯${otherType.jp}ã€‚èˆˆå‘³æ·±ã„ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã™ã­ã€‚` },
                    { t: 6000, speaker: "me", text: "ç§ãŸã¡ã®ç›¸æ€§ã¯ã©ã†ã§ã—ã‚‡ã†ã‹ï¼Ÿæ€è€ƒå›è·¯ã®å¹²æ¸‰ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚" },
                    { t: 8000, speaker: "other", text: "è£œå®Œé–¢ä¿‚ã«ã‚ã‚‹ã‚ˆã†ã§ã™ã€‚ã‚ãªãŸã®å¼±ç‚¹ã‚’ç§ãŒã‚«ãƒãƒ¼ã§ãã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚" },
                    { t: 10000, speaker: "sys", text: "MATCHING COMPLETE" }
                ];

                let timeouts = [];
                conversation.forEach(line => {
                    timeouts.push(setTimeout(() => {
                        setLogs(prev => [...prev, line]);
                        if (line.speaker === 'sys') {
                            setTimeout(onComplete, 1500);
                        }
                    }, line.t));
                });

                const interval = setInterval(() => {
                    setProgress(p => Math.min(p + 1, 100));
                }, 100);

                return () => {
                    timeouts.forEach(clearTimeout);
                    clearInterval(interval);
                };
            }, []);

            return (
                <div className="absolute inset-0 bg-slate-900/90 z-50 flex flex-col items-center justify-center p-6 backdrop-blur-xl">
                    <div className="w-full max-w-xs relative h-64 mb-8">
                        {/* My Twin */}
                        <div className="absolute left-0 top-1/2 -translate-y-1/2 animate-float">
                            <div className={`w-20 h-20 rounded-full bg-gradient-to-br ${myType.color} blur-md absolute opacity-50`}></div>
                            <div className="w-20 h-20 rounded-full bg-white flex items-center justify-center text-2xl shadow-lg relative z-10 border-2 border-white">
                                ğŸ’
                            </div>
                            <p className="text-white text-[10px] text-center mt-2 opacity-80">YOU</p>
                        </div>

                        {/* Connection Line */}
                        <div className="absolute left-20 right-20 top-1/2 h-0.5 bg-gradient-to-r from-purple-500 to-blue-500 opacity-50">
                            <div className="absolute top-0 bottom-0 bg-white w-2 animate-ping" style={{ left: `${progress}%` }}></div>
                        </div>

                        {/* Other Twin */}
                        <div className="absolute right-0 top-1/2 -translate-y-1/2 animate-float" style={{ animationDelay: '-1s' }}>
                            <div className={`w-20 h-20 rounded-full bg-gradient-to-br ${otherType.color} blur-md absolute opacity-50`}></div>
                            <div className="w-20 h-20 rounded-full bg-white flex items-center justify-center text-2xl shadow-lg relative z-10 border-2 border-white">
                                ğŸ‘¤
                            </div>
                            <p className="text-white text-[10px] text-center mt-2 opacity-80">TARGET</p>
                        </div>
                    </div>

                    {/* Log Console */}
                    <div className="w-full bg-black/50 rounded-xl p-4 h-48 overflow-y-auto font-mono text-xs space-y-2 border border-white/10">
                        {logs.map((l, i) => (
                            <div key={i} className={`animate-fade-in ${l.speaker === 'me' ? 'text-purple-300' : l.speaker === 'other' ? 'text-blue-300' : 'text-green-400 font-bold text-center'}`}>
                                <span className="opacity-50">[{new Date().toLocaleTimeString()}]</span> {l.speaker !== 'sys' && <span className="font-bold">{l.speaker === 'me' ? 'YOU' : 'TWIN'}: </span>}
                                {l.text}
                            </div>
                        ))}
                        <div ref={el => el && el.scrollIntoView({ behavior: "smooth" })} />
                    </div>
                </div>
            );
        };

        const TwinScreen = () => {
            const [input, setInput] = useState("");
            const [chat, setChat] = useState([
                { id: 1, sender: "twin", text: "ã“ã‚“ã«ã¡ã¯ã€‚ä»Šæ—¥ã®å¿ƒã®å¤©æ°—ã¯ã©ã†ã§ã™ã‹ï¼Ÿ" }
            ]);
            const scrollRef = useRef(null);

            useEffect(() => {
                if (scrollRef.current) {
                    scrollRef.current.scrollTop = scrollRef.current.scrollHeight;
                }
            }, [chat]);

            const send = () => {
                if (!input.trim()) return;
                setChat([...chat, { id: Date.now(), sender: "me", text: input }]);
                setInput("");
                setTimeout(() => {
                    setChat(prev => [...prev, { id: Date.now() + 1, sender: "twin", text: "ãªã‚‹ã»ã©...ãã®æ„Ÿæƒ…ã¯å¤§åˆ‡ã«è¨˜éŒ²ã—ã¦ãŠãã¾ã™ã­ã€‚ã‚ãªãŸã®ã€Œãƒ‡ã‚¸ã‚¿ãƒ«ãƒ„ã‚¤ãƒ³ã€ãŒã¾ãŸä¸€ã¤æˆé•·ã—ã¾ã—ãŸã€‚" }]);
                }, 1000);
            };

            return (
                <div className="flex flex-col h-full relative animate-fade-in">
                    <div className="h-[35%] flex flex-col items-center justify-center relative">
                        <div className="w-48 h-48 rounded-full bg-gradient-to-tr from-purple-300 via-pink-300 to-blue-300 blur-xl opacity-60 absolute animate-pulse"></div>
                        <div className="w-32 h-32 rounded-full bg-gradient-to-b from-white to-purple-100 shadow-lg z-10 animate-float flex items-center justify-center">
                            <div className="w-28 h-28 rounded-full bg-white/80 backdrop-blur flex items-center justify-center">
                                <div className="text-4xl opacity-50">âœ¨</div>
                            </div>
                        </div>
                        <div className="mt-4 z-10 text-center">
                            <h2 className="text-slate-600 text-sm font-bold tracking-widest">MY TWIN</h2>
                            <p className="text-slate-400 text-[10px]">Sync Level: 12%</p>
                        </div>
                    </div>
                    <div className="flex-1 glass rounded-t-[2.5rem] shadow-inner flex flex-col overflow-hidden">
                        <div className="flex-1 p-4 overflow-y-auto no-scrollbar space-y-4" ref={scrollRef}>
                            {chat.map(c => (
                                <div key={c.id} className={`flex ${c.sender === 'me' ? 'justify-end' : 'justify-start'}`}>
                                    <div className={`max-w-[80%] px-4 py-3 rounded-2xl text-sm shadow-sm ${c.sender === 'me' ? 'bg-purple-500 text-white rounded-br-none' : 'bg-white text-slate-600 rounded-bl-none'
                                        }`}>
                                        {c.text}
                                    </div>
                                </div>
                            ))}
                        </div>
                        <div className="p-4 pb-28 bg-white/50 z-20 relative">
                            <div className="flex items-center bg-white rounded-full px-4 py-3 shadow-md border border-slate-100">
                                <input
                                    className="flex-1 bg-transparent outline-none text-sm text-slate-600"
                                    placeholder="æ„Ÿæƒ…ã‚’å…¥åŠ›..."
                                    value={input}
                                    onChange={e => setInput(e.target.value)}
                                    onKeyDown={e => e.key === 'Enter' && send()}
                                />
                                <button onClick={send} className="text-purple-400 hover:text-purple-600 p-1">
                                    <Icon name="Send" size={20} />
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const DiagnosisScreen = () => {
            const [state, setState] = useState('intro'); // intro, question, calculating, result
            const [qIndex, setQIndex] = useState(0);
            const [scores, setScores] = useState({ EI: 0, SN: 0, TF: 0, JP: 0, V: 0, M: 0 });
            const [result, setResult] = useState(null);

            const startDiagnosis = () => {
                setQIndex(0);
                setScores({ EI: 0, SN: 0, TF: 0, JP: 0, V: 0, M: 0 });
                setState('question');
            };

            const answer = (val) => {
                const newScores = { ...scores };
                Object.keys(val).forEach(k => newScores[k] += val[k]);
                setScores(newScores);

                if (qIndex < QUESTIONS.length - 1) {
                    setQIndex(qIndex + 1);
                } else {
                    setState('calculating');
                    setTimeout(() => calculateResult(newScores), 2000);
                }
            };

            const calculateResult = (finalScores) => {
                // Determine MBTI
                const e_i = finalScores.EI >= 0 ? "E" : "I";
                const s_n = finalScores.SN >= 0 ? "N" : "S"; // Note: In my logic +SN is N (Abstract), -SN is S (Concrete)
                const t_f = finalScores.TF >= 0 ? "F" : "T"; // +TF is F (Feeling)
                const j_p = finalScores.JP >= 0 ? "P" : "J"; // +JP is P (Perceiving)
                const mbti = e_i + s_n + t_f + j_p;

                const archetype = RESULT_ARCHETYPES[mbti] || RESULT_ARCHETYPES["INFJ"];

                // Determine Texture
                let texture = "Standard";
                if (finalScores.V > 5) texture = "Hyperphantasia (è¶…é®®æ˜)";
                else if (finalScores.V < -5) texture = "Aphantasia (æ¦‚å¿µçš„)";

                setResult({
                    ...archetype,
                    mbti,
                    scores: finalScores,
                    texture
                });
                setState('result');
            };

            if (state === 'intro') {
                return (
                    <div className="h-full p-8 flex flex-col items-center justify-center animate-fade-in pb-28 relative overflow-hidden">
                        <div className="absolute top-0 left-0 w-full h-full bg-gradient-to-b from-transparent to-white/80 z-0"></div>
                        <div className="z-10 text-center mb-12">
                            <div className="w-24 h-24 bg-white rounded-full shadow-xl flex items-center justify-center text-4xl mb-6 mx-auto animate-float">
                                ğŸ”®
                            </div>
                            <h1 className="text-3xl font-bold text-slate-700 mb-3 tracking-tight">Deep Dive</h1>
                            <p className="text-sm text-slate-500 leading-relaxed">
                                50ã®å•ã„ã‹ã‘ã«ã‚ˆã‚‹ã€<br />ã‚ãªãŸè‡ªèº«ã¨ã®å¯¾è©±ã€‚<br />
                                <span className="text-xs opacity-70 mt-2 block">MBTI Ã— æ€è€ƒã®ç™– Ã— è¨˜æ†¶ã®è³ªæ„Ÿ</span>
                            </p>
                        </div>
                        <button onClick={startDiagnosis} className="z-10 w-full py-4 bg-slate-800 text-white rounded-2xl shadow-lg hover:bg-slate-700 transition-all font-bold text-lg flex items-center justify-center gap-2 group">
                            <span>å¯¾è©±ã‚’å§‹ã‚ã‚‹</span>
                            <Icon name="Send" size={18} className="group-hover:translate-x-1 transition-transform" />
                        </button>
                    </div>
                );
            }

            if (state === 'question') {
                const q = QUESTIONS[qIndex];
                const progress = ((qIndex + 1) / QUESTIONS.length) * 100;
                return (
                    <div className="h-full flex flex-col pt-10 px-6 pb-28 animate-fade-in">
                        <div className="w-full h-1 bg-slate-100 rounded-full mb-8 overflow-hidden">
                            <div className="h-full bg-purple-400 transition-all duration-500" style={{ width: `${progress}%` }}></div>
                        </div>

                        <div className="flex-1 flex flex-col justify-center">
                            <span className="text-purple-400 font-bold text-xs tracking-widest mb-4">QUESTION {qIndex + 1} / {QUESTIONS.length}</span>
                            <h2 className="text-xl font-bold text-slate-700 mb-10 leading-relaxed">{q.text}</h2>

                            <div className="space-y-3">
                                {q.options.map((opt, i) => (
                                    <button
                                        key={i}
                                        onClick={() => answer(opt.val)}
                                        className="w-full p-4 bg-white border border-slate-100 rounded-xl text-left text-slate-600 text-sm shadow-sm hover:border-purple-300 hover:bg-purple-50 transition-all active:scale-95"
                                    >
                                        {opt.text}
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>
                );
            }

            if (state === 'calculating') {
                return (
                    <div className="h-full flex flex-col items-center justify-center pb-28">
                        <div className="w-16 h-16 border-4 border-purple-200 border-t-purple-500 rounded-full animate-spin mb-4"></div>
                        <p className="text-slate-500 text-sm animate-pulse">ã‚ãªãŸã®æœ¬è³ªã‚’åˆ†æä¸­...</p>
                    </div>
                );
            }

            if (state === 'result' && result) {
                return (
                    <div className="h-full flex flex-col items-center animate-slide-up overflow-y-auto no-scrollbar pb-32 px-6 pt-6">
                        <button onClick={() => setState('intro')} className="absolute top-6 right-6 p-2 bg-white/50 rounded-full z-10 hover:bg-white">
                            <Icon name="Refresh" size={20} color="#A0AEC0" />
                        </button>

                        <h2 className="text-slate-400 text-[10px] font-bold tracking-widest mb-6 mt-4">ANALYSIS COMPLETE</h2>

                        {/* Main Card */}
                        <div className="w-full bg-white/90 backdrop-blur-xl rounded-[2.5rem] p-8 shadow-2xl border border-white relative overflow-hidden group mb-6">
                            <div className={`absolute top-0 left-0 w-full h-48 bg-gradient-to-br ${result.color} opacity-40`}></div>

                            <div className="relative z-10 flex flex-col items-center text-center mt-4">
                                <div className="w-24 h-24 bg-white rounded-full shadow-xl flex items-center justify-center text-4xl mb-4 ring-4 ring-white/50">ğŸ’</div>
                                <span className="bg-slate-800 text-white px-3 py-1 rounded-full text-[10px] font-bold tracking-widest mb-3">{result.mbti}</span>
                                <h1 className="text-2xl font-bold text-slate-800 mb-1">{result.jp}</h1>
                                <p className="text-xs text-slate-500 font-medium mb-6">{result.name}</p>

                                <p className="text-sm text-slate-600 leading-relaxed bg-white/60 p-4 rounded-2xl mb-6 border border-white/50">
                                    {result.desc}
                                </p>

                                {/* Stats Grid */}
                                <div className="w-full grid grid-cols-2 gap-3">
                                    <div className="bg-slate-50 p-3 rounded-2xl text-left border border-slate-100">
                                        <p className="text-[10px] text-slate-400 font-bold mb-1">MEMORY TEXTURE</p>
                                        <p className="text-xs font-bold text-slate-700">{result.texture}</p>
                                    </div>
                                    <div className="bg-slate-50 p-3 rounded-2xl text-left border border-slate-100">
                                        <p className="text-[10px] text-slate-400 font-bold mb-1">THINKING STYLE</p>
                                        <p className="text-xs font-bold text-slate-700">{result.scores.M > 0 ? "Conceptual (æ¦‚å¿µ)" : "Verbal (è¨€èª)"}</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Detailed Analysis */}
                        <div className="w-full space-y-4">
                            <div className="bg-white p-5 rounded-3xl shadow-sm border border-slate-50">
                                <h3 className="text-sm font-bold text-slate-700 mb-3 flex items-center gap-2">
                                    <span className="w-1 h-4 bg-purple-400 rounded-full"></span>
                                    æ€è€ƒã®ç™–
                                </h3>
                                <p className="text-xs text-slate-500 leading-relaxed">
                                    {result.scores.M > 0
                                        ? "ã‚ãªãŸã¯è¨€è‘‰ã‚ˆã‚Šã‚‚å…ˆã«ã€Œã‚¤ãƒ¡ãƒ¼ã‚¸ã€ã‚„ã€Œæ„Ÿè¦šã€ã§ç‰©äº‹ã‚’æ‰ãˆã‚‹ã‚¿ã‚¤ãƒ—ã§ã™ã€‚è«–ç†çš„ãªèª¬æ˜ã‚ˆã‚Šã‚‚ã€æ¯”å–©ã‚„å…¨ä½“åƒã®æŠŠæ¡ã‚’å¥½ã¿ã¾ã™ã€‚"
                                        : "ã‚ãªãŸã¯é ­ã®ä¸­ã§ã€Œè¨€è‘‰ã€ã‚’ä½¿ã£ã¦æ€è€ƒã‚’çµ„ã¿ç«‹ã¦ã‚‹ã‚¿ã‚¤ãƒ—ã§ã™ã€‚è«–ç†çš„ãªæ•´åˆæ€§ã‚’é‡è¦–ã—ã€è¨€èªåŒ–ã™ã‚‹ã“ã¨ã§ç†è§£ã‚’æ·±ã‚ã¾ã™ã€‚"}
                                </p>
                            </div>

                            <div className="bg-white p-5 rounded-3xl shadow-sm border border-slate-50">
                                <h3 className="text-sm font-bold text-slate-700 mb-3 flex items-center gap-2">
                                    <span className="w-1 h-4 bg-blue-400 rounded-full"></span>
                                    è¨˜æ†¶ã®è³ªæ„Ÿ
                                </h3>
                                <p className="text-xs text-slate-500 leading-relaxed">
                                    {result.scores.V > 0
                                        ? "ã‚ãªãŸã®è¨˜æ†¶ã¯é®®æ˜ãªæ˜ åƒã¨ã—ã¦ä¿å­˜ã•ã‚Œã¦ã„ã¾ã™ã€‚éå»ã®å‡ºæ¥äº‹ã‚’æ˜ ç”»ã®ã‚ˆã†ã«å†ç”Ÿã—ãŸã‚Šã€æ¶ç©ºã®é¢¨æ™¯ã‚’ã‚ã‚Šã‚ã‚Šã¨æƒ³åƒã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚"
                                        : "ã‚ãªãŸã®è¨˜æ†¶ã¯äº‹å®Ÿã‚„æ„å‘³ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¨ã—ã¦ä¿å­˜ã•ã‚Œã¦ã„ã¾ã™ã€‚æ˜ åƒçš„ãªãƒã‚¤ã‚ºã«æƒ‘ã‚ã•ã‚Œãšã€æœ¬è³ªçš„ãªæƒ…å ±ã‚’æŠ½å‡ºã™ã‚‹ã“ã¨ã«é•·ã‘ã¦ã„ã¾ã™ã€‚"}
                                </p>
                            </div>
                        </div>

                        <button className="mt-8 w-full bg-slate-800 text-white px-8 py-4 rounded-2xl font-bold shadow-lg flex items-center justify-center gap-2 hover:scale-105 transition-transform">
                            <Icon name="Share" size={18} color="white" /> çµæœã‚’ã‚·ã‚§ã‚¢ã™ã‚‹
                        </button>
                    </div>
                );
            }
            return null;
        };

        const MatchScreen = () => {
            const [feed, setFeed] = useState([
                { id: 1, name: "Anonymous A", type: "Visionary", jp: "å­¤é«˜ã®è¨­è¨ˆè€…", sos: "ä¼ç”»", text: "æ–°ã—ã„ã‚µãƒ¼ãƒ“ã‚¹ã‚’æ€ã„ã¤ã„ãŸã‘ã©ã€å…·ä½“çš„ãªã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã«è½ã¨ã—è¾¼ã‚ãªã„...", color: "from-indigo-200 to-slate-300" },
                { id: 2, name: "Anonymous B", type: "Artist", jp: "æ„Ÿæ€§ã®æ—…äºº", sos: "ç™ºä¿¡", text: "ä½œå“ã«ã¯è‡ªä¿¡ãŒã‚ã‚‹ã®ã«ã€SNSã§ã©ã†è¨€è‘‰ã«ã—ã¦ã„ã„ã‹åˆ†ã‹ã‚‰ãªã„ã€‚", color: "from-green-100 to-yellow-200" },
                { id: 3, name: "Anonymous C", type: "Leader", jp: "ä¸å±ˆã®æŒ‡æ®å®˜", sos: "å‚¾è´", text: "å¼·ã„è¨€è‘‰ã§ãƒãƒ¼ãƒ ã‚’å¼•ã£å¼µã‚Šã™ãã¦ç–²å¼Šã•ã›ã¦ã—ã¾ã£ãŸã€‚", color: "from-blue-200 to-indigo-200" }
            ]);
            const [simulating, setSimulating] = useState(null); // ID of user being simulated

            const handleConnect = (target) => {
                setSimulating(target);
            };

            const handleSimulationComplete = () => {
                setFeed(feed.filter(f => f.id !== simulating.id));
                setSimulating(null);
                alert("ãƒãƒƒãƒãƒ³ã‚°ãŒæˆç«‹ã—ã¾ã—ãŸã€‚é€£çµ¡å…ˆãŒäº¤æ›ã•ã‚Œã¾ã—ãŸã€‚");
            };

            return (
                <div className="h-full flex flex-col relative animate-fade-in">
                    {simulating && (
                        <TwinSimulation
                            myType={{ jp: "å¤¢è¦‹ã‚‹ç™’ã—æ‰‹", color: "from-pink-200 to-purple-200" }} // Mock user type
                            otherType={simulating}
                            onComplete={handleSimulationComplete}
                        />
                    )}

                    <div className="px-6 pt-6 pb-2 bg-white/50 backdrop-blur z-10">
                        <h1 className="text-xl font-bold text-slate-700">Twin Match</h1>
                        <p className="text-xs text-slate-500">ãƒ‡ã‚¸ã‚¿ãƒ«ãƒ„ã‚¤ãƒ³åŒå£«ã‚’å¯¾è©±ã•ã›ã‚‹</p>
                    </div>

                    <div className="flex-1 overflow-y-auto p-4 space-y-4 pb-32 no-scrollbar">
                        {feed.length === 0 ? (
                            <div className="text-center py-20 text-slate-400">No more signals...</div>
                        ) : feed.map(item => (
                            <div key={item.id} className="bg-white rounded-[2rem] p-5 shadow-sm border border-slate-100 animate-slide-up">
                                <div className="flex justify-between items-start mb-3">
                                    <div className="flex items-center gap-3">
                                        <div className={`w-12 h-12 rounded-full bg-gradient-to-br ${item.color} flex items-center justify-center text-xl shadow-inner`}>ğŸ‘¤</div>
                                        <div>
                                            <p className="text-xs font-bold text-slate-700">{item.jp}</p>
                                            <span className="text-[10px] bg-slate-100 text-slate-500 px-2 py-0.5 rounded-md font-bold">SOS: {item.sos}</span>
                                        </div>
                                    </div>
                                </div>
                                <p className="text-sm text-slate-600 leading-relaxed mb-4 bg-slate-50 p-3 rounded-xl">"{item.text}"</p>
                                <button
                                    onClick={() => handleConnect(item)}
                                    className="w-full py-3 bg-white border-2 border-purple-100 text-purple-500 rounded-xl text-xs font-bold flex items-center justify-center gap-2 hover:bg-purple-50 transition-colors"
                                >
                                    <Icon name="Refresh" size={14} /> ãƒ„ã‚¤ãƒ³åŒå£«ã‚’ä¼šã‚ã›ã‚‹
                                </button>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        const App = () => {
            const [tab, setTab] = useState('home');

            return (
                <div className="w-full max-w-md h-[100dvh] sm:h-[800px] bg-gradient-to-br from-slate-50 via-purple-50 to-blue-50 sm:rounded-[3rem] sm:border-8 border-white shadow-2xl overflow-hidden relative flex flex-col font-sans">

                    {/* Top Bar */}
                    <div className="h-14 flex items-center justify-between px-6 pt-2 shrink-0 z-20">
                        <span className="font-bold text-slate-400 text-xs tracking-widest">MindAxis</span>
                        <div className="flex gap-1">
                            <div className="w-2 h-2 rounded-full bg-slate-300"></div>
                            <div className="w-2 h-2 rounded-full bg-slate-300"></div>
                        </div>
                    </div>

                    {/* Content Area */}
                    <div className="flex-1 overflow-hidden relative z-10">
                        {tab === 'home' && <TwinScreen />}
                        {tab === 'diag' && <DiagnosisScreen />}
                        {tab === 'match' && <MatchScreen />}
                    </div>

                    {/* Bottom Navigation (Floating) */}
                    <div className="absolute bottom-6 left-6 right-6 h-16 glass rounded-full flex items-center justify-around shadow-xl z-50">
                        <button onClick={() => setTab('home')} className={`p-3 rounded-full transition ${tab === 'home' ? 'text-purple-500 bg-purple-50' : 'text-slate-400'}`}>
                            <Icon name="Home" size={24} />
                        </button>
                        <button onClick={() => setTab('diag')} className={`p-3 rounded-full transition ${tab === 'diag' ? 'text-purple-500 bg-purple-50' : 'text-slate-400'}`}>
                            <Icon name="Feather" size={24} />
                        </button>
                        <button onClick={() => setTab('match')} className={`p-3 rounded-full transition ${tab === 'match' ? 'text-purple-500 bg-purple-50' : 'text-slate-400'}`}>
                            <Icon name="HeartHand" size={24} />
                        </button>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>